<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Analyseur Centris</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem 1.5rem;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .card {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 1.5rem;
    }
    textarea {
      width: 100%;
      min-height: 120px;
      resize: vertical;
      padding: 0.5rem;
      font-family: monospace;
    }
    .row {
      margin-bottom: 1rem;
    }
    .label {
      font-weight: 600;
      display: block;
      margin-bottom: 0.25rem;
    }
    .error {
      background: #ffe5e5;
      color: #b80000;
      padding: 0.75rem 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      border: 1px solid #ffb3b3;
    }
    pre {
      background: #111827;
      color: #e5e7eb;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.9rem;
    }
    button {
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      border: none;
      background: #2563eb;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover {
      background: #1d4ed8;
    }
    .mode-switch {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .mode-switch label {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      cursor: pointer;
    }
    .section-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      margin-top: 1rem;
    }
    ul {
      padding-left: 1.2rem;
    }
  </style>
</head>
<body>
  <h1>Analyseur Centris</h1>

  <div class="card">
    {% if error %}
      <div class="error">
        {{ error }}
      </div>
    {% endif %}

    <form method="POST">
      <div class="row">
        <div class="label">Mode d'analyse</div>
        <div class="mode-switch">
          <label>
            <input type="radio" name="mode" value="single"
                   {% if not batch_results %}checked{% endif %}>
            Une seule annonce (URL ou HTML collé)
          </label>
          <label>
            <input type="radio" name="mode" value="batch"
                   {% if batch_results %}checked{% endif %}>
            Plusieurs liens (un par ligne)
          </label>
        </div>
      </div>

      <div class="row">
        <div class="label">Une seule annonce (URL Centris ou HTML collé)</div>
        <textarea name="content" placeholder="https://www.centris.ca/fr/plex~a-vendre~..."></textarea>
      </div>

      <div class="row">
        <div class="label">Mode batch (plusieurs URLs, une par ligne)</div>
        <textarea name="urls" placeholder="https://www.centris.ca/fr/duplex~a-vendre~...&#10;https://www.centris.ca/fr/triplex~a-vendre~..."></textarea>
      </div>

      <button type="submit">Analyser</button>
    </form>
  </div>

  {% if result %}
    <div class="card">
      <div class="section-title">Résultat (mode une annonce)</div>
      <!-- ensure_ascii enlevé ici -->
      <pre>{{ result | tojson(indent=2) }}</pre>
    </div>
  {% endif %}

  {% if batch_results %}
    <div class="card">
      <div class="section-title">Résultats (mode batch)</div>
      <ul>
        {% for item in batch_results %}
          <li style="margin-bottom: 1rem;">
            <div><strong>URL :</strong> {{ item.url }}</div>
            {% if item.error %}
              <div class="error" style="margin-top: 0.5rem;">
                {{ item.error }}
              </div>
            {% elif item.data %}
              <!-- ensure_ascii enlevé ici aussi -->
              <pre style="margin-top: 0.5rem;">{{ item.data | tojson(indent=2) }}</pre>
            {% else %}
              <div style="margin-top: 0.5rem; font-style: italic;">
                Aucun résultat.
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
</body>
</html>
